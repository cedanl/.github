name: Add issues to CEDA Board

on:
  workflow_dispatch:
  schedule:
    # Elk uur
    - cron: '0 * * * *'

env:
  PROJECT_NUMBER: 2
  PROJECT_OWNER: cedanl

jobs:
  add-issues:
    runs-on: ubuntu-latest
    steps:
      - name: Add new issues to CEDA Board
        env:
          GH_TOKEN: ${{ secrets.PROJECT_TOKEN }}
        run: |
          # Get all repos in cedanl org
          repos=$(gh repo list cedanl --json name --jq '.[].name')

          for repo in $repos; do
            echo "Processing cedanl/$repo..."

            # Get all open issues from this repo
            issues=$(gh issue list --repo "cedanl/$repo" --state open --json number,title --limit 100 2>/dev/null || echo "[]")

            echo "$issues" | jq -c '.[]' | while read -r issue; do
              title=$(echo "$issue" | jq -r '.title')
              number=$(echo "$issue" | jq -r '.number')

              # Try to add to project (will fail silently if already added)
              result=$(gh project item-add $PROJECT_NUMBER --owner $PROJECT_OWNER --url "https://github.com/cedanl/$repo/issues/$number" 2>/dev/null || echo "skip")

              if [ "$result" != "skip" ]; then
                echo "Added issue #$number from $repo: $title"
              fi
            done
          done

          echo "Sync complete!"
